name: Trunk install test workflow

on:
  pull_request:
    branches:
      - main
    paths:
      - '.github/workflows/trunk-install-test.yml'

jobs:
  test:
    name: Run tests
    runs-on:
      - self-hosted
      - dind
      - large-8x8
    container: quay.io/tembo/trunk-test:0.0.1
#    env:
#      DATABASE_URL: "postgresql://postgres:postgres@localhost:5432/postgres"
#      PGHOST: "localhost"
#      PGPORT: "5432"
#      PGDATABASE: "postgres"
#      PGUSER: "postgres"
#      PGPASSWORD: "postgres"
#
#    services:
#      # Label used to access the service container
#      postgres:
#        # Docker Hub image
#        image: postgres
#        # Provide the password for postgres
#        env:
#          POSTGRES_PASSWORD: postgres
#        # Set health checks to wait until postgres has started
#        options: >-
#          --health-cmd pg_isready
#          --health-interval 10s
#          --health-timeout 5s
#          --health-retries 5
#        ports:
#          # Maps tcp port 5432 on service container to the host
#          - 5432:5432
    steps:
      - name: Trunk Version
        run: |
         trunk --version && psql -l
